{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Zarządzanie Pluginami</h1>
    <div id="plugin-list-section">
        <div class="alert alert-info">Ładowanie listy pluginów...</div>
    </div>
</div>
{% endblock %}
{% block extra_js %}
<script>
function fetchPlugins() {
    fetch('/api/plugins')
        .then(r => {
            if (!r.ok) throw new Error('Błąd API: ' + r.status);
            return r.json();
        })
        .then(data => renderPluginList(data))
        .catch(err => {
            document.getElementById('plugin-list-section').innerHTML = `<div class='alert alert-danger'>Błąd ładowania pluginów: ${err.message}</div>`;
        });
}
function renderPluginList(plugins) {
    if (!Object.keys(plugins).length) {
        document.getElementById('plugin-list-section').innerHTML = '<div class="alert alert-warning">Brak pluginów do wyświetlenia.</div>';
        return;
    }
    let html = '<table class="table table-bordered"><thead><tr><th>Nazwa</th><th>Status</th><th>Akcje</th></tr></thead><tbody>';
    for (const [name, info] of Object.entries(plugins)) {
        html += `<tr><td>${name}</td><td>${info.enabled ? '<span class="badge bg-success">Włączony</span>' : '<span class="badge bg-secondary">Wyłączony</span>'}</td>`;
        html += `<td>
            <button class="btn btn-sm btn-${info.enabled ? 'warning' : 'success'} me-2" onclick="togglePlugin('${name}', ${info.enabled})">${info.enabled ? 'Wyłącz' : 'Włącz'}</button>
            <button class="btn btn-sm btn-info" onclick="reloadPlugin('${name}')">Przeładuj</button>
        </td></tr>`;
    }
    html += '</tbody></table>';
    document.getElementById('plugin-list-section').innerHTML = html;
}
function togglePlugin(name, enabled) {
    fetch(`/api/plugins/${name}/${enabled ? 'disable' : 'enable'}`, {method: 'POST'})
        .then(r => r.json())
        .then(() => fetchPlugins());
}
function reloadPlugin(name) {
    fetch(`/api/plugins/${name}/reload`, {method: 'POST'})
        .then(r => r.json())
        .then(() => fetchPlugins());
}
document.addEventListener('DOMContentLoaded', fetchPlugins);
</script>
{% endblock %}
